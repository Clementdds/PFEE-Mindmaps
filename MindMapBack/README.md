The MindMapBack directory is a backend written in Java 14.
It is essential to the good behaviour of the web viewer from the 'Website' directory.

# DEPLOYMENT

This backend can be deployed using docker.

Please run the following commands

`cd MindMapBack`

`docker-compose up`

The backend should then be running on port 9999.

------------------------------------------------------------------------------

# API

The API documentation in this file is not up to date.

The latest documentation is generated by swagger and can be accessed at the following url :

`http://localhost:9999/swagger-ui/`

NB : The application must be running.

-------------------------------------------------------------------------------

This backend exposes the following endpoints, with DOMAIN as the domain name :

-------------------------------------------------------------------------------

### USERS

###### Sign Up a new user :

POST http://DOMAIN:9999/users/signup

Body :
```
{
    "email" : "xxx@xxx.xxx",
    "password" : "xxx"
}
```
Response :
```
{
    "token" : "xxx",
    "error" : "xxx"
}
```
Return code :
 - 200 OK
 - 403 User already exists
 - 502 Error on database insertion

###### Login

POST http://DOMAIN:9999/users/login

Body:
```
{
    "email" : "xxx@xxx.xxx",
    "password" : "xxx"
}
```
Response :
```
{
    "token" : "xxx",
    "error" : "xxx"
}
```
Return code :
 - 200 OK
 - 401 User/Password pair does not exist

###### Logout

GET http://DOMAIN:9999/users/logout

Header :

`Authorization : Bearer xxxTOKENxxx`

Response :

```
{
    "error" : "xxx"
}
```
Return code :
 - 200 OK
 - 401 Token invalid or user not recognized

### MINDMAPS

###### Upload a new mindmap

/!\ You can't upload a **public** mindmap and share it. If you wanna share a mindmap, it should be in **private**

POST http://DOMAIN:9999/mindmaps/create

Header :

`Authorization : Bearer xxxTOKENxxx`

Body:
```
{
    "text" : "JSON_DOC",
    "name" : "example_mindmap"
    "isPublic" : true|false
    "emails": [ "Email1", "Email2" ] | null
}
```
Response :
```
{
    "id" : "xxx",
    "error" : "xxx"
}
```
NB : id can later be used to access the uploaded mindmap.

Return code :
 - 200 OK
 - 400 You attempted to share a public mindmap
 - 401 Token invalid or user not recognized
 - 404 Mindmap not found for this id
 - 502 Database insertion error

###### Delete a mindmap

DELETE http://DOMAIN:9999/mindmaps/{mapId}

Header :

`Authorization : Bearer xxxTOKENxxx`

Return code :
 - 200 OK
 - 401 Token invalid or user not recognized
 - 403 You are not allowed to delete this mindmap
 - 404 Mindmap not found for this id

###### Get owned mindmaps

GET http://DOMAIN:9999/mindmaps/getowned

Header :

`Authorization : Bearer xxxTOKENxxx`

Response :
```
{
    "mindmapsList": [
        {
            "id": X,
            "name": "XXX",
            "isPublic": true/false
        },
        ...
    ],
    "error": null
}
```
Return code :
 - 200 OK
 - 401 Token invalid or user not recognized

###### Get Shared mindmaps

GET http://DOMAIN:9999/mindmaps/getshared

Header :

`Authorization : Bearer xxxTOKENxxx`

Response :
```
{
    "mindmapsList": [
        {
            "id": X,
            "name": "XXX",
            "isPublic": false
        },
        ...
    ],
    "error": null
}
```
Return code :
 - 200 OK
 - 401 Token invalid or user not recognized

###### Get the mindmap's json body from its id

GET http://DOMAIN:9999/mindmaps/getMindmapFromId?mapId=X

Header :


`Authorization : Bearer xxxTOKENxxx`


Response :
```
{
    "mindmap" : "Json du mindmap"
    "error"   : "null"
}
```
Return code :
 - 200 OK
 - 401 Token invalid or user not recognized
 - 404 Mindmap not found for this id

### LINKS

###### Get mindmap from url

GET http://DOMAIN:9999/links/getPublicMindmapFromUrl?url=X

Response :
```
{
    "nodeid"  : BigInt, nodeid
    "mindmap" : String, Json du mindmap complet
    "error"   : null
}
```

###### Get mindmap from url WHEN THE USER IS LOGGED

GET http://DOMAIN:9999/links/getPrivateMindmapFromUrl?url=X

Header :

`Authorization : Bearer xxxTOKENxxx`

Response :
```
{
    "nodeid"  : BigInt, nodeid
    "mindmap" : String, Json du mindmap complet
    "error"   : null
}
```

###### Add a mindmap link in public

*N.B. the owner id of a private mindmap is the id of the user that send the request*

POST http://DOMAIN:9999/links/postLink

Header :

`Authorization : Bearer xxxTOKENxxx`

Body:
```
{
    "idMindmap" : Int du mindmap,
    "nodeid"    : Bigint Id du node,
    "isPublic"  : true/false,
    "emails"     : Array of Username -- should be emails
}
```

Response :
```
{
    "url": "UrlGenerated",
    "error": "null"
    "addedEmails": [
        "thomas.curti@epita.fr",
        "vincent1.masson@epita.fr"
    ]
}
```